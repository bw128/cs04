// Copyright 2015-2024, University of Colorado Boulder

/**
 * Front of the HeaterCoolerNode.  It is independent from the HeaterCoolerBack so that one can easily layer objects
 * inside of the HeaterCoolerNode.  The HeaterCoolerFront contains the heater body, labels, and control slider.
 *
 * @author Siddhartha Chinthapally (Actual Concepts) on 20-11-2014.
 * @author Jesse Greenberg
 *
 */

import BooleanProperty from '../../axon/js/BooleanProperty.js';
import Dimension2 from '../../dot/js/Dimension2.js';
import Range from '../../dot/js/Range.js';
import { Shape } from '../../kite/js/imports.js';
import optionize, { combineOptions } from '../../phet-core/js/optionize.js';
import { Color, LinearGradient, Node, Path, Text } from '../../scenery/js/imports.js';
import VSlider from '../../sun/js/VSlider.js';
import Tandem from '../../tandem/js/Tandem.js';
import HeaterCoolerBack from './HeaterCoolerBack.js';
import PhetFont from './PhetFont.js';
import sceneryPhet from './sceneryPhet.js';
import SceneryPhetStrings from './SceneryPhetStrings.js';
const DEFAULT_WIDTH = 120; // in screen coords, much of the rest of the size of the stove derives from this value

export default class HeaterCoolerFront extends Node {
  // please use judiciously, see https://github.com/phetsims/scenery-phet/issues/442

  static DEFAULT_BASE_COLOR = 'rgb( 159, 182, 205 )';

  /**
   * @param heatCoolAmountProperty +1 for max heating, -1 for max cooling
   * @param providedOptions
   */
  constructor(heatCoolAmountProperty, providedOptions) {
    super();
    const options = optionize()({
      // SelfOptions
      baseColor: HeaterCoolerFront.DEFAULT_BASE_COLOR,
      width: 120,
      heatEnabled: true,
      coolEnabled: true,
      snapToZero: true,
      snapToZeroThreshold: 0.1,
      heatString: SceneryPhetStrings.heatStringProperty,
      coolString: SceneryPhetStrings.coolStringProperty,
      labelFont: new PhetFont(14),
      labelMaxWidth: 35,
      thumbSize: new Dimension2(45, 22),
      thumbTouchAreaXDilation: 11,
      thumbTouchAreaYDilation: 11,
      thumbMouseAreaXDilation: 0,
      thumbMouseAreaYDilation: 0,
      thumbFill: '#71edff',
      thumbFillHighlighted: '#bff7ff',
      heaterCoolerBack: null,
      sliderOptions: {
        trackSize: new Dimension2(10, DEFAULT_WIDTH / 2),
        // height of the track depends on the width
        trackFillEnabled: new LinearGradient(0, 0, DEFAULT_WIDTH / 2, 0).addColorStop(0, '#0A00F0').addColorStop(1, '#EF000F'),
        thumbLineWidth: 1.4,
        thumbCenterLineStroke: 'black',
        majorTickLength: 15,
        minorTickLength: 12
      },
      snapToZeroPropertyOptions: {
        phetioDocumentation: 'whether the slider will snap to the off position when released',
        phetioFeatured: true
      },
      phetioInstrument: true,
      // NodeOptions
      tandem: Tandem.REQUIRED,
      tandemNameSuffix: 'HeaterCoolerNode',
      phetioType: Node.NodeIO
    }, providedOptions);
    assert && assert(options.heatEnabled || options.coolEnabled, 'Either heat or cool must be enabled.');
    assert && assert(options.snapToZeroThreshold >= 0 && options.snapToZeroThreshold <= 1, `options.snapToZeroThreshold must be between 0 and 1: ${options.snapToZeroThreshold}`);

    // Dimensions for the rest of the stove, dependent on the specified stove width.  Empirically determined, and could
    // be made into options if needed.
    const height = DEFAULT_WIDTH * 0.75;
    const burnerOpeningHeight = DEFAULT_WIDTH * HeaterCoolerBack.OPENING_HEIGHT_SCALE;
    const bottomWidth = DEFAULT_WIDTH * 0.80;

    // Create the body of the stove.
    const stoveBodyShape = new Shape().ellipticalArc(DEFAULT_WIDTH / 2, burnerOpeningHeight / 4, DEFAULT_WIDTH / 2, burnerOpeningHeight / 2, 0, 0, Math.PI, false).lineTo((DEFAULT_WIDTH - bottomWidth) / 2, height + burnerOpeningHeight / 2).ellipticalArc(DEFAULT_WIDTH / 2, height + burnerOpeningHeight / 4, bottomWidth / 2, burnerOpeningHeight, 0, Math.PI, 0, true).lineTo(DEFAULT_WIDTH, burnerOpeningHeight / 2);
    const stoveBaseColor = Color.toColor(options.baseColor);
    const stoveBody = new Path(stoveBodyShape, {
      stroke: 'black',
      fill: new LinearGradient(0, 0, DEFAULT_WIDTH, 0).addColorStop(0, stoveBaseColor.brighterColor(0.5)).addColorStop(1, stoveBaseColor.darkerColor(0.5))
    });
    this.snapToZeroProperty = new BooleanProperty(options.snapToZero, combineOptions({
      tandem: options.tandem.createTandem('snapToZeroProperty')
    }, options.snapToZeroPropertyOptions));
    const sliderRange = new Range(options.coolEnabled ? -1 : 0, options.heatEnabled ? 1 : 0);

    /**
     * determines if the slider is close enough to zero to snap to zero (even when snapToZeroProperty is false). It's
     * only applicable when both heating and cooling are enabled because that is the only configuration where it was
     * difficult for a user to set the slider to 0. This feature was requested by designers,
     * see https://github.com/phetsims/scenery-phet/issues/568.
     */
    const sliderIsCloseToZero = () => {
      return options.coolEnabled && options.heatEnabled && (heatCoolAmountProperty.value < 0 && heatCoolAmountProperty.value / sliderRange.min < options.snapToZeroThreshold || heatCoolAmountProperty.value > 0 && heatCoolAmountProperty.value / sliderRange.max < options.snapToZeroThreshold);
    };
    const setSliderToZero = () => {
      heatCoolAmountProperty.set(0);
    };
    this.slider = new VSlider(heatCoolAmountProperty, sliderRange, combineOptions({
      thumbTouchAreaXDilation: options.thumbTouchAreaXDilation,
      thumbTouchAreaYDilation: options.thumbTouchAreaYDilation,
      thumbMouseAreaXDilation: options.thumbMouseAreaXDilation,
      thumbMouseAreaYDilation: options.thumbMouseAreaYDilation,
      thumbFill: options.thumbFill,
      thumbSize: options.thumbSize,
      thumbFillHighlighted: options.thumbFillHighlighted,
      endDrag: event => {
        // This only happens for mouse/touch events because it is a poor user experience to reset back to zero
        // every time a key is released. For keyboard input, it is reset to zero when the slider loses focus.
        const isFromPDOM = event && event.isFromPDOM();
        if (!isFromPDOM && this.snapToZeroProperty.value || sliderIsCloseToZero()) {
          setSliderToZero();
        }
      },
      centerY: stoveBody.centerY,
      right: stoveBody.right - DEFAULT_WIDTH / 8,
      tandem: options.tandem.createTandem('slider')
    }, options.sliderOptions));

    // Set the slider back to zero when it loses focus.
    this.slider.addInputListener({
      blur: setSliderToZero
    });

    // Create the tick labels.
    const labelOptions = {
      font: options.labelFont,
      maxWidth: options.labelMaxWidth
    };
    let heatTickText;
    if (options.heatEnabled) {
      heatTickText = new Text(options.heatString, labelOptions); // dispose required, may link to a StringProperty
      this.slider.addMajorTick(1, heatTickText);
    }
    this.slider.addMinorTick(0);
    let coolTickText;
    if (options.coolEnabled) {
      coolTickText = new Text(options.coolString, labelOptions); // dispose required, may link to a StringProperty
      this.slider.addMajorTick(-1, coolTickText);
    }
    this.addChild(stoveBody);
    this.addChild(this.slider);
    if (!options.phetioInstrument) {
      options.tandem = Tandem.OPT_OUT;
    }
    this.mutate(options);

    // update the back component if provided
    if (options.heaterCoolerBack) {
      const heaterCoolerBack = options.heaterCoolerBack;
      this.opacityProperty.lazyLink(opacity => {
        heaterCoolerBack.opacity = opacity;
      });
      this.pickableProperty.lazyLink(pickable => {
        heaterCoolerBack.pickable = pickable;
      });
      this.visibleProperty.lazyLink(visible => {
        heaterCoolerBack.visible = visible;
      });
    }

    // return the slider to its origin if snapToZero is changed to true
    this.snapToZeroProperty.link(snapToZero => {
      snapToZero && setSliderToZero();
    });
    this.disposeHeaterCoolerFront = () => {
      heatTickText && heatTickText.dispose();
      coolTickText && coolTickText.dispose();
    };
  }
  dispose() {
    this.disposeHeaterCoolerFront();
    super.dispose();
  }
}
sceneryPhet.register('HeaterCoolerFront', HeaterCoolerFront);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEaW1lbnNpb24yIiwiUmFuZ2UiLCJTaGFwZSIsIm9wdGlvbml6ZSIsImNvbWJpbmVPcHRpb25zIiwiQ29sb3IiLCJMaW5lYXJHcmFkaWVudCIsIk5vZGUiLCJQYXRoIiwiVGV4dCIsIlZTbGlkZXIiLCJUYW5kZW0iLCJIZWF0ZXJDb29sZXJCYWNrIiwiUGhldEZvbnQiLCJzY2VuZXJ5UGhldCIsIlNjZW5lcnlQaGV0U3RyaW5ncyIsIkRFRkFVTFRfV0lEVEgiLCJIZWF0ZXJDb29sZXJGcm9udCIsIkRFRkFVTFRfQkFTRV9DT0xPUiIsImNvbnN0cnVjdG9yIiwiaGVhdENvb2xBbW91bnRQcm9wZXJ0eSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJiYXNlQ29sb3IiLCJ3aWR0aCIsImhlYXRFbmFibGVkIiwiY29vbEVuYWJsZWQiLCJzbmFwVG9aZXJvIiwic25hcFRvWmVyb1RocmVzaG9sZCIsImhlYXRTdHJpbmciLCJoZWF0U3RyaW5nUHJvcGVydHkiLCJjb29sU3RyaW5nIiwiY29vbFN0cmluZ1Byb3BlcnR5IiwibGFiZWxGb250IiwibGFiZWxNYXhXaWR0aCIsInRodW1iU2l6ZSIsInRodW1iVG91Y2hBcmVhWERpbGF0aW9uIiwidGh1bWJUb3VjaEFyZWFZRGlsYXRpb24iLCJ0aHVtYk1vdXNlQXJlYVhEaWxhdGlvbiIsInRodW1iTW91c2VBcmVhWURpbGF0aW9uIiwidGh1bWJGaWxsIiwidGh1bWJGaWxsSGlnaGxpZ2h0ZWQiLCJoZWF0ZXJDb29sZXJCYWNrIiwic2xpZGVyT3B0aW9ucyIsInRyYWNrU2l6ZSIsInRyYWNrRmlsbEVuYWJsZWQiLCJhZGRDb2xvclN0b3AiLCJ0aHVtYkxpbmVXaWR0aCIsInRodW1iQ2VudGVyTGluZVN0cm9rZSIsIm1ham9yVGlja0xlbmd0aCIsIm1pbm9yVGlja0xlbmd0aCIsInNuYXBUb1plcm9Qcm9wZXJ0eU9wdGlvbnMiLCJwaGV0aW9Eb2N1bWVudGF0aW9uIiwicGhldGlvRmVhdHVyZWQiLCJwaGV0aW9JbnN0cnVtZW50IiwidGFuZGVtIiwiUkVRVUlSRUQiLCJ0YW5kZW1OYW1lU3VmZml4IiwicGhldGlvVHlwZSIsIk5vZGVJTyIsImFzc2VydCIsImhlaWdodCIsImJ1cm5lck9wZW5pbmdIZWlnaHQiLCJPUEVOSU5HX0hFSUdIVF9TQ0FMRSIsImJvdHRvbVdpZHRoIiwic3RvdmVCb2R5U2hhcGUiLCJlbGxpcHRpY2FsQXJjIiwiTWF0aCIsIlBJIiwibGluZVRvIiwic3RvdmVCYXNlQ29sb3IiLCJ0b0NvbG9yIiwic3RvdmVCb2R5Iiwic3Ryb2tlIiwiZmlsbCIsImJyaWdodGVyQ29sb3IiLCJkYXJrZXJDb2xvciIsInNuYXBUb1plcm9Qcm9wZXJ0eSIsImNyZWF0ZVRhbmRlbSIsInNsaWRlclJhbmdlIiwic2xpZGVySXNDbG9zZVRvWmVybyIsInZhbHVlIiwibWluIiwibWF4Iiwic2V0U2xpZGVyVG9aZXJvIiwic2V0Iiwic2xpZGVyIiwiZW5kRHJhZyIsImV2ZW50IiwiaXNGcm9tUERPTSIsImNlbnRlclkiLCJyaWdodCIsImFkZElucHV0TGlzdGVuZXIiLCJibHVyIiwibGFiZWxPcHRpb25zIiwiZm9udCIsIm1heFdpZHRoIiwiaGVhdFRpY2tUZXh0IiwiYWRkTWFqb3JUaWNrIiwiYWRkTWlub3JUaWNrIiwiY29vbFRpY2tUZXh0IiwiYWRkQ2hpbGQiLCJPUFRfT1VUIiwibXV0YXRlIiwib3BhY2l0eVByb3BlcnR5IiwibGF6eUxpbmsiLCJvcGFjaXR5IiwicGlja2FibGVQcm9wZXJ0eSIsInBpY2thYmxlIiwidmlzaWJsZVByb3BlcnR5IiwidmlzaWJsZSIsImxpbmsiLCJkaXNwb3NlSGVhdGVyQ29vbGVyRnJvbnQiLCJkaXNwb3NlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJIZWF0ZXJDb29sZXJGcm9udC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNS0yMDI0LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBGcm9udCBvZiB0aGUgSGVhdGVyQ29vbGVyTm9kZS4gIEl0IGlzIGluZGVwZW5kZW50IGZyb20gdGhlIEhlYXRlckNvb2xlckJhY2sgc28gdGhhdCBvbmUgY2FuIGVhc2lseSBsYXllciBvYmplY3RzXHJcbiAqIGluc2lkZSBvZiB0aGUgSGVhdGVyQ29vbGVyTm9kZS4gIFRoZSBIZWF0ZXJDb29sZXJGcm9udCBjb250YWlucyB0aGUgaGVhdGVyIGJvZHksIGxhYmVscywgYW5kIGNvbnRyb2wgc2xpZGVyLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNpZGRoYXJ0aGEgQ2hpbnRoYXBhbGx5IChBY3R1YWwgQ29uY2VwdHMpIG9uIDIwLTExLTIwMTQuXHJcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnXHJcbiAqXHJcbiAqL1xyXG5cclxuaW1wb3J0IEJvb2xlYW5Qcm9wZXJ0eSwgeyBCb29sZWFuUHJvcGVydHlPcHRpb25zIH0gZnJvbSAnLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRGltZW5zaW9uMiBmcm9tICcuLi8uLi9kb3QvanMvRGltZW5zaW9uMi5qcyc7XHJcbmltcG9ydCBSYW5nZSBmcm9tICcuLi8uLi9kb3QvanMvUmFuZ2UuanMnO1xyXG5pbXBvcnQgeyBTaGFwZSB9IGZyb20gJy4uLy4uL2tpdGUvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUsIHsgY29tYmluZU9wdGlvbnMgfSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IHsgQ29sb3IsIEZvbnQsIExpbmVhckdyYWRpZW50LCBOb2RlLCBOb2RlT3B0aW9ucywgUGF0aCwgVENvbG9yLCBUZXh0IH0gZnJvbSAnLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IHsgU2xpZGVyT3B0aW9ucyB9IGZyb20gJy4uLy4uL3N1bi9qcy9TbGlkZXIuanMnO1xyXG5pbXBvcnQgVlNsaWRlciBmcm9tICcuLi8uLi9zdW4vanMvVlNsaWRlci5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBIZWF0ZXJDb29sZXJCYWNrIGZyb20gJy4vSGVhdGVyQ29vbGVyQmFjay5qcyc7XHJcbmltcG9ydCBQaGV0Rm9udCBmcm9tICcuL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHNjZW5lcnlQaGV0IGZyb20gJy4vc2NlbmVyeVBoZXQuanMnO1xyXG5pbXBvcnQgU2NlbmVyeVBoZXRTdHJpbmdzIGZyb20gJy4vU2NlbmVyeVBoZXRTdHJpbmdzLmpzJztcclxuXHJcbmNvbnN0IERFRkFVTFRfV0lEVEggPSAxMjA7IC8vIGluIHNjcmVlbiBjb29yZHMsIG11Y2ggb2YgdGhlIHJlc3Qgb2YgdGhlIHNpemUgb2YgdGhlIHN0b3ZlIGRlcml2ZXMgZnJvbSB0aGlzIHZhbHVlXHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG5cclxuICBiYXNlQ29sb3I/OiBDb2xvciB8IHN0cmluZzsgLy8gQmFzZSBjb2xvciB1c2VkIGZvciB0aGUgc3RvdmUgYm9keS5cclxuICB3aWR0aD86IG51bWJlcjsgLy8gSW4gc2NyZWVuIGNvb3JkcywgbXVjaCBvZiB0aGUgcmVzdCBvZiB0aGUgc2l6ZSBvZiB0aGUgc3RvdmUgZGVyaXZlcyBmcm9tIHRoaXMgdmFsdWUuXHJcbiAgaGVhdEVuYWJsZWQ/OiBib29sZWFuOyAvLyBBbGxvd3Mgc2xpZGVyIHRvIHJlYWNoIHBvc2l0aXZlIHZhbHVlcyAoY29ycmVzcG9uZGluZyB0byBoZWF0aW5nKVxyXG4gIGNvb2xFbmFibGVkPzogYm9vbGVhbjsgLy8gQWxsb3dzIHNsaWRlciB0byByZWFjaCBuZWdhdGl2ZSB2YWx1ZXMgKGNvcnJlc3BvbmRpbmcgdG8gY29vbGluZylcclxuICBzbmFwVG9aZXJvPzogYm9vbGVhbjsgLy8gc2VlIGRvYyBhdCB0aGlzLnNuYXBUb1plcm9Qcm9wZXJ0eVxyXG5cclxuICAvLyB0aGUgcGVyY2VudGFnZSBvZiB0aGUgc2xpZGVyJ3MgbWluaW11bSBhbmQgbWF4aW11bSByYW5nZSBhdCB3aGljaCB0aGUgc2xpZGVyIHNob3VsZCBzbmFwIHRvIHplcm8gd2hlblxyXG4gIC8vIHJlbGVhc2VkLiBOb3RlIHRoYXQgaXQncyBvbmx5IHVzZWQgd2hlbiB0aGlzLnNuYXBUb1plcm9Qcm9wZXJ0eSBpcyBmYWxzZSBhbmQgd2hlbiBib3RoIGhlYXRpbmcgYW5kIGNvb2xpbmdcclxuICAvLyBhcmUgZW5hYmxlZC4gQSB2YWx1ZSBvZiAxIGlzIHRoZSBzYW1lIGFzIHNuYXBUb1plcm86IHRydWUsIGFuZCBhIHZhbHVlIG9mIDAgcmVtb3ZlcyBzbmFwcGluZyBlbnRpcmVseS5cclxuICAvLyBEZWZhdWx0IHZhbHVlIGVtcGlyaWNhbGx5IGRldGVybWluZWQsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc2NlbmVyeS1waGV0L2lzc3Vlcy81NjhcclxuICBzbmFwVG9aZXJvVGhyZXNob2xkPzogbnVtYmVyO1xyXG5cclxuICAvLyBzbGlkZXIgbGFiZWwgb3B0aW9uc1xyXG4gIGhlYXRTdHJpbmc/OiBzdHJpbmcgfCBUUmVhZE9ubHlQcm9wZXJ0eTxzdHJpbmc+OyAvLyBsYWJlbCBmb3IgKzEgZW5kIG9mIHNsaWRlclxyXG4gIGNvb2xTdHJpbmc/OiBzdHJpbmcgfCBUUmVhZE9ubHlQcm9wZXJ0eTxzdHJpbmc+OyAvLyB7c3RyaW5nfSBsYWJlbCBmb3IgLTEgZW5kIG9mIHNsaWRlclxyXG4gIGxhYmVsRm9udD86IEZvbnQ7XHJcbiAgbGFiZWxNYXhXaWR0aD86IG51bWJlcjsgLy8gbWF4V2lkdGggb2YgdGhlIEhlYXQgYW5kIENvb2wgbGFiZWxzLCBkZXRlcm1pbmVkIGVtcGlyaWNhbGx5XHJcblxyXG4gIC8vIHNsaWRlciBvcHRpb25zXHJcbiAgdGh1bWJTaXplPzogRGltZW5zaW9uMjtcclxuICB0aHVtYlRvdWNoQXJlYVhEaWxhdGlvbj86IG51bWJlcjtcclxuICB0aHVtYlRvdWNoQXJlYVlEaWxhdGlvbj86IG51bWJlcjtcclxuICB0aHVtYk1vdXNlQXJlYVhEaWxhdGlvbj86IG51bWJlcjtcclxuICB0aHVtYk1vdXNlQXJlYVlEaWxhdGlvbj86IG51bWJlcjtcclxuICB0aHVtYkZpbGw/OiBUQ29sb3I7XHJcbiAgdGh1bWJGaWxsSGlnaGxpZ2h0ZWQ/OiBUQ29sb3I7XHJcblxyXG4gIC8vIGxpbmtzIHRoZSBOb2RlSU8gUHJvcGVydGllcyBvZiB0aGUgcHJvdmlkZWQgSGVhdGVyQ29vbGVyQmFjayB0byB0aGlzIEhlYXRlckNvb2xlckZyb250XHJcbiAgaGVhdGVyQ29vbGVyQmFjaz86IEhlYXRlckNvb2xlckJhY2sgfCBudWxsO1xyXG5cclxuICBzbGlkZXJPcHRpb25zPzogU2xpZGVyT3B0aW9ucztcclxuXHJcbiAgLy8gUGFzc2VkIHRvIHNuYXBUb1plcm9Qcm9wZXJ0eVxyXG4gIHNuYXBUb1plcm9Qcm9wZXJ0eU9wdGlvbnM/OiBCb29sZWFuUHJvcGVydHlPcHRpb25zO1xyXG5cclxuICAvLyBIZWF0ZXJDb29sZXJGcm9udCBpcyBzb21ldGltZXMgaW5zdHJ1bWVudGVkIGFzIGEgcGFyZW50IGNvbXBvbmVudCwgYW5kIGlzIHNvbWV0aW1lcyBhIHN1Yi1jb21wb2VudCB0b1xyXG4gIC8vIEhlYXRlckNvb2xlck5vZGUuanMuIFRoaXMgb3B0aW9uIHByb3ZpZGVzIHRoZSBhYmlsaXR5IHRvIGxpbWl0IHRoZSBudW1iZXIgb2YgaW50ZXJtZWRpYXRlIE5vZGVzIGluIHRoZVxyXG4gIC8vIGluc3RydW1lbnRlZCB0cmVlLiBUaGlzIGRvZXNuJ3QgYWZmZWN0IHRoZSBpbnN0cnVtZW50YXRpb24gb2Ygc3ViLWNvbXBvbmVudHMgbGlrZSB0aGUgc2xpZGVyLlxyXG4gIHBoZXRpb0luc3RydW1lbnQ/OiBib29sZWFuO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgSGVhdGVyQ29vbGVyRnJvbnRPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBOb2RlT3B0aW9ucztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEhlYXRlckNvb2xlckZyb250IGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8vIHBsZWFzZSB1c2UganVkaWNpb3VzbHksIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc2NlbmVyeS1waGV0L2lzc3Vlcy80NDJcclxuICBwdWJsaWMgcmVhZG9ubHkgc2xpZGVyOiBWU2xpZGVyO1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IHNuYXBUb1plcm9Qcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZUhlYXRlckNvb2xlckZyb250OiAoKSA9PiB2b2lkO1xyXG5cclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IERFRkFVTFRfQkFTRV9DT0xPUiA9ICdyZ2IoIDE1OSwgMTgyLCAyMDUgKSc7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBoZWF0Q29vbEFtb3VudFByb3BlcnR5ICsxIGZvciBtYXggaGVhdGluZywgLTEgZm9yIG1heCBjb29saW5nXHJcbiAgICogQHBhcmFtIHByb3ZpZGVkT3B0aW9uc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggaGVhdENvb2xBbW91bnRQcm9wZXJ0eTogTnVtYmVyUHJvcGVydHksIHByb3ZpZGVkT3B0aW9ucz86IEhlYXRlckNvb2xlckZyb250T3B0aW9ucyApIHtcclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxIZWF0ZXJDb29sZXJGcm9udE9wdGlvbnMsIFNlbGZPcHRpb25zLCBOb2RlT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gU2VsZk9wdGlvbnNcclxuICAgICAgYmFzZUNvbG9yOiBIZWF0ZXJDb29sZXJGcm9udC5ERUZBVUxUX0JBU0VfQ09MT1IsXHJcbiAgICAgIHdpZHRoOiAxMjAsXHJcbiAgICAgIGhlYXRFbmFibGVkOiB0cnVlLFxyXG4gICAgICBjb29sRW5hYmxlZDogdHJ1ZSxcclxuICAgICAgc25hcFRvWmVybzogdHJ1ZSxcclxuICAgICAgc25hcFRvWmVyb1RocmVzaG9sZDogMC4xLFxyXG4gICAgICBoZWF0U3RyaW5nOiBTY2VuZXJ5UGhldFN0cmluZ3MuaGVhdFN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICBjb29sU3RyaW5nOiBTY2VuZXJ5UGhldFN0cmluZ3MuY29vbFN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICBsYWJlbEZvbnQ6IG5ldyBQaGV0Rm9udCggMTQgKSxcclxuICAgICAgbGFiZWxNYXhXaWR0aDogMzUsXHJcbiAgICAgIHRodW1iU2l6ZTogbmV3IERpbWVuc2lvbjIoIDQ1LCAyMiApLFxyXG4gICAgICB0aHVtYlRvdWNoQXJlYVhEaWxhdGlvbjogMTEsXHJcbiAgICAgIHRodW1iVG91Y2hBcmVhWURpbGF0aW9uOiAxMSxcclxuICAgICAgdGh1bWJNb3VzZUFyZWFYRGlsYXRpb246IDAsXHJcbiAgICAgIHRodW1iTW91c2VBcmVhWURpbGF0aW9uOiAwLFxyXG4gICAgICB0aHVtYkZpbGw6ICcjNzFlZGZmJyxcclxuICAgICAgdGh1bWJGaWxsSGlnaGxpZ2h0ZWQ6ICcjYmZmN2ZmJyxcclxuICAgICAgaGVhdGVyQ29vbGVyQmFjazogbnVsbCxcclxuICAgICAgc2xpZGVyT3B0aW9uczoge1xyXG4gICAgICAgIHRyYWNrU2l6ZTogbmV3IERpbWVuc2lvbjIoIDEwLCBERUZBVUxUX1dJRFRIIC8gMiApLCAvLyBoZWlnaHQgb2YgdGhlIHRyYWNrIGRlcGVuZHMgb24gdGhlIHdpZHRoXHJcbiAgICAgICAgdHJhY2tGaWxsRW5hYmxlZDogbmV3IExpbmVhckdyYWRpZW50KCAwLCAwLCBERUZBVUxUX1dJRFRIIC8gMiwgMCApXHJcbiAgICAgICAgICAuYWRkQ29sb3JTdG9wKCAwLCAnIzBBMDBGMCcgKVxyXG4gICAgICAgICAgLmFkZENvbG9yU3RvcCggMSwgJyNFRjAwMEYnICksXHJcbiAgICAgICAgdGh1bWJMaW5lV2lkdGg6IDEuNCxcclxuICAgICAgICB0aHVtYkNlbnRlckxpbmVTdHJva2U6ICdibGFjaycsXHJcbiAgICAgICAgbWFqb3JUaWNrTGVuZ3RoOiAxNSxcclxuICAgICAgICBtaW5vclRpY2tMZW5ndGg6IDEyXHJcbiAgICAgIH0sXHJcbiAgICAgIHNuYXBUb1plcm9Qcm9wZXJ0eU9wdGlvbnM6IHtcclxuICAgICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnd2hldGhlciB0aGUgc2xpZGVyIHdpbGwgc25hcCB0byB0aGUgb2ZmIHBvc2l0aW9uIHdoZW4gcmVsZWFzZWQnLFxyXG4gICAgICAgIHBoZXRpb0ZlYXR1cmVkOiB0cnVlXHJcbiAgICAgIH0sXHJcbiAgICAgIHBoZXRpb0luc3RydW1lbnQ6IHRydWUsXHJcblxyXG4gICAgICAvLyBOb2RlT3B0aW9uc1xyXG4gICAgICB0YW5kZW06IFRhbmRlbS5SRVFVSVJFRCxcclxuICAgICAgdGFuZGVtTmFtZVN1ZmZpeDogJ0hlYXRlckNvb2xlck5vZGUnLFxyXG4gICAgICBwaGV0aW9UeXBlOiBOb2RlLk5vZGVJT1xyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggb3B0aW9ucy5oZWF0RW5hYmxlZCB8fCBvcHRpb25zLmNvb2xFbmFibGVkLCAnRWl0aGVyIGhlYXQgb3IgY29vbCBtdXN0IGJlIGVuYWJsZWQuJyApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggb3B0aW9ucy5zbmFwVG9aZXJvVGhyZXNob2xkID49IDAgJiYgb3B0aW9ucy5zbmFwVG9aZXJvVGhyZXNob2xkIDw9IDEsXHJcbiAgICAgIGBvcHRpb25zLnNuYXBUb1plcm9UaHJlc2hvbGQgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDE6ICR7b3B0aW9ucy5zbmFwVG9aZXJvVGhyZXNob2xkfWAgKTtcclxuXHJcbiAgICAvLyBEaW1lbnNpb25zIGZvciB0aGUgcmVzdCBvZiB0aGUgc3RvdmUsIGRlcGVuZGVudCBvbiB0aGUgc3BlY2lmaWVkIHN0b3ZlIHdpZHRoLiAgRW1waXJpY2FsbHkgZGV0ZXJtaW5lZCwgYW5kIGNvdWxkXHJcbiAgICAvLyBiZSBtYWRlIGludG8gb3B0aW9ucyBpZiBuZWVkZWQuXHJcbiAgICBjb25zdCBoZWlnaHQgPSBERUZBVUxUX1dJRFRIICogMC43NTtcclxuICAgIGNvbnN0IGJ1cm5lck9wZW5pbmdIZWlnaHQgPSBERUZBVUxUX1dJRFRIICogSGVhdGVyQ29vbGVyQmFjay5PUEVOSU5HX0hFSUdIVF9TQ0FMRTtcclxuICAgIGNvbnN0IGJvdHRvbVdpZHRoID0gREVGQVVMVF9XSURUSCAqIDAuODA7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSBib2R5IG9mIHRoZSBzdG92ZS5cclxuICAgIGNvbnN0IHN0b3ZlQm9keVNoYXBlID0gbmV3IFNoYXBlKClcclxuICAgICAgLmVsbGlwdGljYWxBcmMoIERFRkFVTFRfV0lEVEggLyAyLCBidXJuZXJPcGVuaW5nSGVpZ2h0IC8gNCwgREVGQVVMVF9XSURUSCAvIDIsIGJ1cm5lck9wZW5pbmdIZWlnaHQgLyAyLCAwLCAwLCBNYXRoLlBJLCBmYWxzZSApXHJcbiAgICAgIC5saW5lVG8oICggREVGQVVMVF9XSURUSCAtIGJvdHRvbVdpZHRoICkgLyAyLCBoZWlnaHQgKyBidXJuZXJPcGVuaW5nSGVpZ2h0IC8gMiApXHJcbiAgICAgIC5lbGxpcHRpY2FsQXJjKCBERUZBVUxUX1dJRFRIIC8gMiwgaGVpZ2h0ICsgYnVybmVyT3BlbmluZ0hlaWdodCAvIDQsIGJvdHRvbVdpZHRoIC8gMiwgYnVybmVyT3BlbmluZ0hlaWdodCxcclxuICAgICAgICAwLCBNYXRoLlBJLCAwLCB0cnVlICkubGluZVRvKCBERUZBVUxUX1dJRFRILCBidXJuZXJPcGVuaW5nSGVpZ2h0IC8gMiApO1xyXG5cclxuICAgIGNvbnN0IHN0b3ZlQmFzZUNvbG9yID0gQ29sb3IudG9Db2xvciggb3B0aW9ucy5iYXNlQ29sb3IgKTtcclxuICAgIGNvbnN0IHN0b3ZlQm9keSA9IG5ldyBQYXRoKCBzdG92ZUJvZHlTaGFwZSwge1xyXG4gICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgIGZpbGw6IG5ldyBMaW5lYXJHcmFkaWVudCggMCwgMCwgREVGQVVMVF9XSURUSCwgMCApXHJcbiAgICAgICAgLmFkZENvbG9yU3RvcCggMCwgc3RvdmVCYXNlQ29sb3IuYnJpZ2h0ZXJDb2xvciggMC41ICkgKVxyXG4gICAgICAgIC5hZGRDb2xvclN0b3AoIDEsIHN0b3ZlQmFzZUNvbG9yLmRhcmtlckNvbG9yKCAwLjUgKSApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5zbmFwVG9aZXJvUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBvcHRpb25zLnNuYXBUb1plcm8sIGNvbWJpbmVPcHRpb25zPEJvb2xlYW5Qcm9wZXJ0eU9wdGlvbnM+KCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnc25hcFRvWmVyb1Byb3BlcnR5JyApXHJcbiAgICB9LCBvcHRpb25zLnNuYXBUb1plcm9Qcm9wZXJ0eU9wdGlvbnMgKSApO1xyXG5cclxuICAgIGNvbnN0IHNsaWRlclJhbmdlID0gbmV3IFJhbmdlKCBvcHRpb25zLmNvb2xFbmFibGVkID8gLTEgOiAwLCBvcHRpb25zLmhlYXRFbmFibGVkID8gMSA6IDAgKTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIGRldGVybWluZXMgaWYgdGhlIHNsaWRlciBpcyBjbG9zZSBlbm91Z2ggdG8gemVybyB0byBzbmFwIHRvIHplcm8gKGV2ZW4gd2hlbiBzbmFwVG9aZXJvUHJvcGVydHkgaXMgZmFsc2UpLiBJdCdzXHJcbiAgICAgKiBvbmx5IGFwcGxpY2FibGUgd2hlbiBib3RoIGhlYXRpbmcgYW5kIGNvb2xpbmcgYXJlIGVuYWJsZWQgYmVjYXVzZSB0aGF0IGlzIHRoZSBvbmx5IGNvbmZpZ3VyYXRpb24gd2hlcmUgaXQgd2FzXHJcbiAgICAgKiBkaWZmaWN1bHQgZm9yIGEgdXNlciB0byBzZXQgdGhlIHNsaWRlciB0byAwLiBUaGlzIGZlYXR1cmUgd2FzIHJlcXVlc3RlZCBieSBkZXNpZ25lcnMsXHJcbiAgICAgKiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3NjZW5lcnktcGhldC9pc3N1ZXMvNTY4LlxyXG4gICAgICovXHJcbiAgICBjb25zdCBzbGlkZXJJc0Nsb3NlVG9aZXJvID0gKCkgPT4ge1xyXG4gICAgICByZXR1cm4gb3B0aW9ucy5jb29sRW5hYmxlZCAmJiBvcHRpb25zLmhlYXRFbmFibGVkICYmIChcclxuICAgICAgICBoZWF0Q29vbEFtb3VudFByb3BlcnR5LnZhbHVlIDwgMCAmJiBoZWF0Q29vbEFtb3VudFByb3BlcnR5LnZhbHVlIC8gc2xpZGVyUmFuZ2UubWluIDwgb3B0aW9ucy5zbmFwVG9aZXJvVGhyZXNob2xkIHx8XHJcbiAgICAgICAgaGVhdENvb2xBbW91bnRQcm9wZXJ0eS52YWx1ZSA+IDAgJiYgaGVhdENvb2xBbW91bnRQcm9wZXJ0eS52YWx1ZSAvIHNsaWRlclJhbmdlLm1heCA8IG9wdGlvbnMuc25hcFRvWmVyb1RocmVzaG9sZCApO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBzZXRTbGlkZXJUb1plcm8gPSAoKSA9PiB7XHJcbiAgICAgIGhlYXRDb29sQW1vdW50UHJvcGVydHkuc2V0KCAwICk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuc2xpZGVyID0gbmV3IFZTbGlkZXIoIGhlYXRDb29sQW1vdW50UHJvcGVydHksIHNsaWRlclJhbmdlLCBjb21iaW5lT3B0aW9uczxTbGlkZXJPcHRpb25zPigge1xyXG4gICAgICB0aHVtYlRvdWNoQXJlYVhEaWxhdGlvbjogb3B0aW9ucy50aHVtYlRvdWNoQXJlYVhEaWxhdGlvbixcclxuICAgICAgdGh1bWJUb3VjaEFyZWFZRGlsYXRpb246IG9wdGlvbnMudGh1bWJUb3VjaEFyZWFZRGlsYXRpb24sXHJcbiAgICAgIHRodW1iTW91c2VBcmVhWERpbGF0aW9uOiBvcHRpb25zLnRodW1iTW91c2VBcmVhWERpbGF0aW9uLFxyXG4gICAgICB0aHVtYk1vdXNlQXJlYVlEaWxhdGlvbjogb3B0aW9ucy50aHVtYk1vdXNlQXJlYVlEaWxhdGlvbixcclxuICAgICAgdGh1bWJGaWxsOiBvcHRpb25zLnRodW1iRmlsbCxcclxuICAgICAgdGh1bWJTaXplOiBvcHRpb25zLnRodW1iU2l6ZSxcclxuICAgICAgdGh1bWJGaWxsSGlnaGxpZ2h0ZWQ6IG9wdGlvbnMudGh1bWJGaWxsSGlnaGxpZ2h0ZWQsXHJcbiAgICAgIGVuZERyYWc6IGV2ZW50ID0+IHtcclxuXHJcbiAgICAgICAgLy8gVGhpcyBvbmx5IGhhcHBlbnMgZm9yIG1vdXNlL3RvdWNoIGV2ZW50cyBiZWNhdXNlIGl0IGlzIGEgcG9vciB1c2VyIGV4cGVyaWVuY2UgdG8gcmVzZXQgYmFjayB0byB6ZXJvXHJcbiAgICAgICAgLy8gZXZlcnkgdGltZSBhIGtleSBpcyByZWxlYXNlZC4gRm9yIGtleWJvYXJkIGlucHV0LCBpdCBpcyByZXNldCB0byB6ZXJvIHdoZW4gdGhlIHNsaWRlciBsb3NlcyBmb2N1cy5cclxuICAgICAgICBjb25zdCBpc0Zyb21QRE9NID0gZXZlbnQgJiYgZXZlbnQuaXNGcm9tUERPTSgpO1xyXG4gICAgICAgIGlmICggIWlzRnJvbVBET00gJiYgdGhpcy5zbmFwVG9aZXJvUHJvcGVydHkudmFsdWUgfHwgc2xpZGVySXNDbG9zZVRvWmVybygpICkge1xyXG4gICAgICAgICAgc2V0U2xpZGVyVG9aZXJvKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBjZW50ZXJZOiBzdG92ZUJvZHkuY2VudGVyWSxcclxuICAgICAgcmlnaHQ6IHN0b3ZlQm9keS5yaWdodCAtIERFRkFVTFRfV0lEVEggLyA4LFxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3NsaWRlcicgKVxyXG4gICAgfSwgb3B0aW9ucy5zbGlkZXJPcHRpb25zICkgKTtcclxuXHJcbiAgICAvLyBTZXQgdGhlIHNsaWRlciBiYWNrIHRvIHplcm8gd2hlbiBpdCBsb3NlcyBmb2N1cy5cclxuICAgIHRoaXMuc2xpZGVyLmFkZElucHV0TGlzdGVuZXIoIHtcclxuICAgICAgYmx1cjogc2V0U2xpZGVyVG9aZXJvXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSB0aWNrIGxhYmVscy5cclxuICAgIGNvbnN0IGxhYmVsT3B0aW9ucyA9IHtcclxuICAgICAgZm9udDogb3B0aW9ucy5sYWJlbEZvbnQsXHJcbiAgICAgIG1heFdpZHRoOiBvcHRpb25zLmxhYmVsTWF4V2lkdGhcclxuICAgIH07XHJcbiAgICBsZXQgaGVhdFRpY2tUZXh0OiBOb2RlO1xyXG4gICAgaWYgKCBvcHRpb25zLmhlYXRFbmFibGVkICkge1xyXG4gICAgICBoZWF0VGlja1RleHQgPSBuZXcgVGV4dCggb3B0aW9ucy5oZWF0U3RyaW5nLCBsYWJlbE9wdGlvbnMgKTsgLy8gZGlzcG9zZSByZXF1aXJlZCwgbWF5IGxpbmsgdG8gYSBTdHJpbmdQcm9wZXJ0eVxyXG4gICAgICB0aGlzLnNsaWRlci5hZGRNYWpvclRpY2soIDEsIGhlYXRUaWNrVGV4dCApO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zbGlkZXIuYWRkTWlub3JUaWNrKCAwICk7XHJcbiAgICBsZXQgY29vbFRpY2tUZXh0OiBOb2RlO1xyXG4gICAgaWYgKCBvcHRpb25zLmNvb2xFbmFibGVkICkge1xyXG4gICAgICBjb29sVGlja1RleHQgPSBuZXcgVGV4dCggb3B0aW9ucy5jb29sU3RyaW5nLCBsYWJlbE9wdGlvbnMgKTsgLy8gZGlzcG9zZSByZXF1aXJlZCwgbWF5IGxpbmsgdG8gYSBTdHJpbmdQcm9wZXJ0eVxyXG4gICAgICB0aGlzLnNsaWRlci5hZGRNYWpvclRpY2soIC0xLCBjb29sVGlja1RleHQgKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmFkZENoaWxkKCBzdG92ZUJvZHkgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMuc2xpZGVyICk7XHJcblxyXG4gICAgaWYgKCAhb3B0aW9ucy5waGV0aW9JbnN0cnVtZW50ICkge1xyXG4gICAgICBvcHRpb25zLnRhbmRlbSA9IFRhbmRlbS5PUFRfT1VUO1xyXG4gICAgfVxyXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyB1cGRhdGUgdGhlIGJhY2sgY29tcG9uZW50IGlmIHByb3ZpZGVkXHJcbiAgICBpZiAoIG9wdGlvbnMuaGVhdGVyQ29vbGVyQmFjayApIHtcclxuICAgICAgY29uc3QgaGVhdGVyQ29vbGVyQmFjayA9IG9wdGlvbnMuaGVhdGVyQ29vbGVyQmFjaztcclxuICAgICAgdGhpcy5vcGFjaXR5UHJvcGVydHkubGF6eUxpbmsoIG9wYWNpdHkgPT4ge1xyXG4gICAgICAgIGhlYXRlckNvb2xlckJhY2sub3BhY2l0eSA9IG9wYWNpdHk7XHJcbiAgICAgIH0gKTtcclxuICAgICAgdGhpcy5waWNrYWJsZVByb3BlcnR5LmxhenlMaW5rKCBwaWNrYWJsZSA9PiB7XHJcbiAgICAgICAgaGVhdGVyQ29vbGVyQmFjay5waWNrYWJsZSA9IHBpY2thYmxlO1xyXG4gICAgICB9ICk7XHJcbiAgICAgIHRoaXMudmlzaWJsZVByb3BlcnR5LmxhenlMaW5rKCB2aXNpYmxlID0+IHtcclxuICAgICAgICBoZWF0ZXJDb29sZXJCYWNrLnZpc2libGUgPSB2aXNpYmxlO1xyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gcmV0dXJuIHRoZSBzbGlkZXIgdG8gaXRzIG9yaWdpbiBpZiBzbmFwVG9aZXJvIGlzIGNoYW5nZWQgdG8gdHJ1ZVxyXG4gICAgdGhpcy5zbmFwVG9aZXJvUHJvcGVydHkubGluayggc25hcFRvWmVybyA9PiB7XHJcbiAgICAgIHNuYXBUb1plcm8gJiYgc2V0U2xpZGVyVG9aZXJvKCk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlSGVhdGVyQ29vbGVyRnJvbnQgPSAoKSA9PiB7XHJcbiAgICAgIGhlYXRUaWNrVGV4dCAmJiBoZWF0VGlja1RleHQuZGlzcG9zZSgpO1xyXG4gICAgICBjb29sVGlja1RleHQgJiYgY29vbFRpY2tUZXh0LmRpc3Bvc2UoKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZUhlYXRlckNvb2xlckZyb250KCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5zY2VuZXJ5UGhldC5yZWdpc3RlciggJ0hlYXRlckNvb2xlckZyb250JywgSGVhdGVyQ29vbGVyRnJvbnQgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFrQyxrQ0FBa0M7QUFJMUYsT0FBT0MsVUFBVSxNQUFNLDRCQUE0QjtBQUNuRCxPQUFPQyxLQUFLLE1BQU0sdUJBQXVCO0FBQ3pDLFNBQVNDLEtBQUssUUFBUSwwQkFBMEI7QUFDaEQsT0FBT0MsU0FBUyxJQUFJQyxjQUFjLFFBQVEsaUNBQWlDO0FBQzNFLFNBQVNDLEtBQUssRUFBUUMsY0FBYyxFQUFFQyxJQUFJLEVBQWVDLElBQUksRUFBVUMsSUFBSSxRQUFRLDZCQUE2QjtBQUVoSCxPQUFPQyxPQUFPLE1BQU0seUJBQXlCO0FBQzdDLE9BQU9DLE1BQU0sTUFBTSwyQkFBMkI7QUFDOUMsT0FBT0MsZ0JBQWdCLE1BQU0sdUJBQXVCO0FBQ3BELE9BQU9DLFFBQVEsTUFBTSxlQUFlO0FBQ3BDLE9BQU9DLFdBQVcsTUFBTSxrQkFBa0I7QUFDMUMsT0FBT0Msa0JBQWtCLE1BQU0seUJBQXlCO0FBRXhELE1BQU1DLGFBQWEsR0FBRyxHQUFHLENBQUMsQ0FBQzs7QUErQzNCLGVBQWUsTUFBTUMsaUJBQWlCLFNBQVNW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